---
layout: post
title: Embedded Systems Part 4 - Interacting with the Analog World
categories: misc
---

Embedded systems are digital. However, the world around us is not made of 1's and 0's. The world we live in is analog. The things we perceive are analog. So no matter how advanced processors can get, they will always need an interface to bridge the gap between the analog world and the digital domain. These interfaces are known as Digital-to-Analog Converters (DACs) and Analog-to-Digital Converters (ADCs). 

# DACs
DACs convert a sequence of bits to an analog voltage. It takes the binary number and convert it to a voltage that is proportional to the binary number. By feeding a DAC with many binary numbers in quick succession we can generate an analog waveform.

The longer the binary number, the higher the resolution of the DAC. This is because more bits translate to more possible output values and hence smaller step sizes with each increment of the binary number. An n-bit DAC will have 2<sup>n</sup> possible outputs. So for example, an 4-bit DAC will have 2<sup>4</sup> or 16 possible outputs. 

The range of the output voltage is determined by V<sub>ref</sub> or the reference voltage of the DAC. V<sub>ref</sub> is generally the logic HIGH voltage of the MCU, which is usually 3.3V or 5V. So for a 3.3V logic level, the DAC output is between 0V to 3.3V. 

The full-scale voltage V<sub>FS</sub> of a DAC is the maximum output voltage, which is achieved when the largest binary number is applied. For a 4-bit DAC, this number is 1111. In general:

$$V_{FS} = (\frac{2^n - 1}{2^n} \times V_{ref})$$

So assuming a V<sub>ref</sub> of 3.3V, the maximum output voltage is about 3.09V. 

## Types of DACs
There are many, many types of DACs out there and to keep this post short and simple, I'll only talk about two common types of DACs (there's plenty of material online if you'd like to learn more). 

### Binary-weighted DAC
First is the binary-weighted DAC. 

<p align="center">
  <img src="/assets/binary_weighted_dac.png">
</p>

The binary-weighted DAC makes clever use of a summing amplifier to perform the digital to analog conversion. Recall that the output voltage of a summing amplifier is given by: 

$$ V_{out} = -(\frac{R_F}{R_1} \times V_{IN1} + \frac{R_F}{R_2} \times V_{IN2} + .... \frac{R_F}{R_n} \times V_{INn}) $$
where n is the number of inputs to the summing amplifier.

Each digit in the binary number is given a different weightage for their contributions to the output analog voltage. The weightages increase in powers of 2, hence the name binary-weighted. 

By plugging in the resistances into the summing amplifier formula, we can see that the most significant bit (MSB) being the highest valued digit, has the highest weightage and the least significant bit (LSB) has the lowest weightage. 

With reference to the above diagram, assume we have a 4-bit binary-weighted DAC, the binary input is 1010 and R = 1kÎ©. Let's also assume that the logic level voltage is 3.3V. So a '1' will represent an input voltage of 3.3V and a '0' will represent an input voltage of 0V. The output is therefore:
$$ V_{out} = -(\frac{1k\Omega}{2k\Omega} \times 3.3V + \frac{1k\Omega}{4k\Omega} \times 0V + \frac{1k\Omega}{8k\Omega} \times 3.3V + \frac{1k\Omega}{16k\Omega} \times 0V)$$
$$V_{out} = - (1.65V + 0V + 0.4125V + 0V) = -2.0625V $$

The binary-weighted DAC is a simple and straightforward design. However, it is actually not so practical as it would require using a large range of resistors with very low tolerances (one for each bit) to obtain an accurate result. This would get expensive real quick for a higher resolution DAC (imagine needing to get 16 different precision resistor values for a 16 bit DAC). 

### R-2R Ladder DAC
<p align="center">
  <img src="/assets/r2r.png">
</p>
